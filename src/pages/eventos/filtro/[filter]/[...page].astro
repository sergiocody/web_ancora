---
/* EVENTOS FILTRADOS POR FECHA (PRÓXIMOS/PASADOS) */
import { getEntry } from "astro:content";
import PageLayoutArchive from "@layouts/PageLayoutArchive.astro";
import { getCollection } from "astro:content";

export async function getStaticPaths({ paginate }) {
  const allPosts = await getCollection("eventos");
  const { data } = await getEntry("config", "eventos");
  const now = new Date();

  // Filtrar eventos próximos (fecha futura o igual a hoy)
  const proximosPosts = allPosts
    .filter((post) => {
      const eventDate = post.data.eventDate || post.data.pubDate;
      return eventDate && new Date(eventDate) >= now;
    })
    .sort((a, b) => {
      const aDate = a.data.eventDate || a.data.pubDate;
      const bDate = b.data.eventDate || b.data.pubDate;
      return aDate.valueOf() - bDate.valueOf();
    });

  // Filtrar eventos pasados (fecha anterior a hoy)
  const pasadosPosts = allPosts
    .filter((post) => {
      const eventDate = post.data.eventDate || post.data.pubDate;
      return !eventDate || new Date(eventDate) < now;
    })
    .sort((a, b) => {
      const aDate = a.data.eventDate || a.data.pubDate;
      const bDate = b.data.eventDate || b.data.pubDate;
      return bDate.valueOf() - aDate.valueOf();
    });

  return [
    ...paginate(proximosPosts, {
      params: { filter: "proximos" },
      pageSize: data.per_page,
      props: { filterName: "Próximos" },
    }),
    ...paginate(pasadosPosts, {
      params: { filter: "pasados" },
      pageSize: data.per_page,
      props: { filterName: "Pasados" },
    }),
  ];
}

const base_url = import.meta.env.BLOG_SLUG;
const { page, filterName } = Astro.props;
const { data } = await getEntry("config", "eventos");

const filters = ["Próximos", "Pasados"];
const filter_type = "filtro";
const filter = filterName;
---

<PageLayoutArchive
  {page}
  {filters}
  {data}
  {base_url}
  {filter}
  {filter_type}
/>
